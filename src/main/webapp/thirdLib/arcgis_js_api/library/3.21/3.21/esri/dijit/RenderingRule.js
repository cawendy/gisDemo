// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.21/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/dijit/templates/RenderingRule.html":'\x3cdiv data-dojo-attach-point\x3d"_renderingRuleContainer" class\x3d"esriRenderingRuleContainer"\x3e\r\n  \x3ctable class\x3d"esriRenderingRuleTable"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ccol class\x3d"esriRenderingRuleCol1"/\x3e\r\n      \x3ccol class\x3d"esriRenderingRuleCol2"/\x3e\r\n      \x3ccol class\x3d"esriRenderingRuleCol3"/\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3clabel class\x3d"esriRenderingRuleHeadingLabel" data-dojo-attach-point\x3d"rendererLabel"\x3e${_i18n.widgets.renderingRule.rendererLabelTitle}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"3" data-dojo-attach-point\x3d"rasterFunctionRow"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"rasterFunctionList" data-dojo-type\x3d"dijit/form/FilteringSelect"\r\n            class\x3d"esriRenderingRuleRasterFunctionList dijitSelect"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"bandIdsLabelBlock"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3clabel class\x3d"esriRenderingRuleHeadingLabel" data-dojo-attach-point\x3d"bandIdsLabel"\x3e${_i18n.widgets.renderingRule.bandCombinationLabelTitle}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"bandIdsBlock"\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"bandIdsRedList" data-dojo-type\x3d"dijit/form/FilteringSelect"\r\n            class\x3d"esriRenderingRuleBandIdsRedList dijitSelect" data-dojo-attach-event\x3d"onChange: _updateStretchStatsGrid"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"bandIdsGreenList" data-dojo-type\x3d"dijit/form/FilteringSelect"\r\n            class\x3d"esriRenderingRuleBandIdsGreenList dijitSelect" data-dojo-attach-event\x3d"onChange: _updateStretchStatsGrid"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"bandIdsBlueList" data-dojo-type\x3d"dijit/form/FilteringSelect"\r\n            class\x3d"esriRenderingRuleBandIdsBlueList dijitSelect" data-dojo-attach-event\x3d"onChange: _updateStretchStatsGrid"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"bandIdsMsgBlock"\x3e\r\n        \x3ctd/\x3e\r\n        \x3ctd colspan\x3d"2"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"msgLabel" class\x3d"esriRenderingRuleMsgLabel"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e      \r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3clabel class\x3d"esriRenderingRuleEnhancementHeadingLabel" data-dojo-attach-point\x3d"imageEnhancementLabel"\x3e${_i18n.widgets.renderingRule.imageEnhancementLabelTitle}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctbody data-dojo-attach-point\x3d"symbologyTypeBlock"\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"symbologyTypeLabelRow" class\x3d"esriRenderingRuleVisible"\x3e\r\n          \x3ctd colspan\x3d"3"\x3e\r\n            \x3clabel class\x3d"esriRenderingRuleSymbologyTypeLabel"\x3e${_i18n.widgets.renderingRule.symbologyTypeLabel}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"symbologyTypeSelectRow" class\x3d"esriRenderingRuleVisible"\x3e\r\n          \x3ctd colspan\x3d"3"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"symbologyTypeSelect" data-dojo-type\x3d"dijit/form/Select" data-dojo-props\x3d"labelAttr: \'label\'"\r\n            class\x3d"esriRnderingRuleSymbologyTypeSelect" data-dojo-attach-event\x3d"onChange: _onSymbologyTypeChange"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n      \x3ctbody data-dojo-attach-point\x3d"stretchBlock"\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"stretchDescLabel"\x3e${_i18n.widgets.renderingRule.stretchDescLabel}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"stretchMethodLabel"\x3e${_i18n.widgets.renderingRule.stretchMethodLabel}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e      \r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3cselect data-dojo-attach-point\x3d"stretchMethodList" style\x3d"width:100%;" data-dojo-type\x3d"dijit/form/Select" class\x3d"esriRenderingRuleStretchMethodList"\x3e\r\n          \x3c/select\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"stretchMethodNoneDescBlock"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"stretchMethodNoneDesc"\x3e${_i18n.widgets.renderingRule.stretchMethodNoneDesc}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e \r\n      \x3ctr data-dojo-attach-point\x3d"stretchMethodMinMaxDescBlock"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"stretchMethodMinMaxDesc"\x3e${_i18n.widgets.renderingRule.stretchMethodMinMaxDesc}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"numStdDevBlock"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"numStdDevLabel"\x3e${_i18n.widgets.renderingRule.numStdDevLabelTitle}\x3c/label\x3e\r\n          \x3cinput type\x3d"text" value\x3d"2.0" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-point\x3d"numStdDevText" class\x3d"esriRenderingRuleFixedInput"\x3e\r\n          \x3c/input\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"numStdDevLabel"\x3e${_i18n.widgets.renderingRule.numStdDevEndLabelTitle}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd/\x3e\r\n        \x3ctd/\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"minMaxPercentDescBlock"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"numStdDescLabel"\x3e${_i18n.widgets.renderingRule.minMaxDescLabelTitle}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e      \r\n      \x3ctr data-dojo-attach-point\x3d"maxPercentBlock"\x3e\r\n        \x3ctd\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"maxPercentLabel"\x3e${_i18n.widgets.renderingRule.maxPercentLabelTitle}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd colspan\x3d"2"\x3e\r\n          \x3cinput data-dojo-type\x3d"dijit/form/NumberTextBox" type\x3d"text" value\x3d"2.0" data-dojo-attach-point\x3d"maxPercentText" class\x3d"esriRenderingRuleFixedInput"\x3e\r\n          \x3c/input\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"percentLabel"\x3e${_i18n.widgets.renderingRule.percentLabelTitle}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e      \r\n      \x3ctr data-dojo-attach-point\x3d"minPercentBlock"\x3e\r\n        \x3ctd\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"minPercentLabel"\x3e${_i18n.widgets.renderingRule.minPercentLabelTitle}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd colspan\x3d"2"\x3e\r\n          \x3cinput data-dojo-type\x3d"dijit/form/NumberTextBox" type\x3d"text" value\x3d"2.0" data-dojo-attach-point\x3d"minPercentText" class\x3d"esriRenderingRuleFixedInput"\x3e\r\n          \x3c/input\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"percentLabel"\x3e${_i18n.widgets.renderingRule.percentLabelTitle}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"gammaBlock"\x3e\r\n        \x3ctd\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"gammaLabel"\x3e${_i18n.widgets.renderingRule.gammaLabelTitle}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd colspan\x3d"2"\x3e\r\n          \x3cdiv id\x3d"gammaSliderID" data-dojo-attach-point\x3d"gammaSlider" class\x3d"esriRenderingRuleGammaSlider" data-dojo-type\x3d"dijit.form.HorizontalSlider" showbuttons\x3d"true" value\x3d"0.0" minimum\x3d"-1" maximum\x3d"1" intermediatechanges\x3d"true"\x3e\r\n            \x3cdiv data-dojo-type\x3d"dijit.form.HorizontalRuleLabels" container\x3d"bottomDecoration" labels\x3d"${_i18n.widgets.renderingRule.minGammaLabel}, ${_i18n.widgets.renderingRule.maxGammaLabel}" style\x3d"height: 1.5em; font-size: 0.8em; color: #666"\x3e\r\n            \x3c/div\x3e        \r\n          \x3c/div\x3e \r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"draBlock"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3cinput type\x3d"checkbox" value\x3d"true" data-dojo-attach-point\x3d"draCheckbox" class\x3d"esriRenderingRuleDraCheckbox" data-dojo-attach-event\x3d"onChange: _onDRAChange"\x3e\r\n          \x3c/input\x3e\r\n          \x3clabel class\x3d"esriRenderingRuleDraLabel" data-dojo-attach-point\x3d"draLabel"\x3e${_i18n.widgets.renderingRule.draLabelTitle}\x3c/label\x3e\r\n        \x3ctd/\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"stretchStatsBlock"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\x3cdiv data-dojo-attach-point\x3d"stretchStatsGrid"\x3e\x3c/div\x3e\x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n      \x3ctbody data-dojo-attach-point\x3d"classifyBlock"\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"classifyFieldBlock"\x3e\r\n          \x3ctd\x3e\r\n            \x3clabel data-dojo-attach-point\x3d"classifyFieldLabel"\x3e${_i18n.widgets.renderingRule.fieldLabel}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd colspan\x3d"2"\x3e\r\n            \x3cinput data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"classifyFieldSelect" class\x3d"esriRenderingRuleClassifySelect"\r\n            data-dojo-props\x3d"labelAttr: \'alias\'" data-dojo-attach-event\x3d"onChange: _onClassifyFieldChange"\x3e\x3c/input\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"classifyMethodBlock"\x3e\r\n          \x3ctd\x3e\r\n            \x3clabel data-dojo-attach-point\x3d"classifyMethodLabel"\x3e${_i18n.widgets.renderingRule.methodLabel}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd colspan\x3d"2"\x3e\r\n            \x3cinput data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-attach-point\x3d"classifyMethodSelect" class\x3d"esriRenderingRuleClassifySelect" \r\n            data-dojo-props\x3d"labelAttr: \'label\', labelType: \'html\'" data-dojo-attach-event\x3d"onChange: _onClassifyMethodChange"\x3e\x3c/input\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"classifyNClassesBlock"\x3e\r\n          \x3ctd\x3e\r\n            \x3clabel data-dojo-attach-point\x3d"classifyNClassesLabel"\x3e${_i18n.widgets.renderingRule.nClassesLabel}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd colspan\x3d"2"\x3e\r\n            \x3cinput data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-point\x3d"classifyNClassesInput" class\x3d"esriRenderingRuleClassifySelect" data-dojo-attach-event\x3d"onChange: _updateClassifyGrid"\x3e\x3c/input\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"classifyIntervalsBlock"\x3e\r\n          \x3ctd\x3e\r\n            \x3clabel data-dojo-attach-point\x3d"classifyIntervalLabel"\x3e${_i18n.widgets.renderingRule.intervalLabel}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd colspan\x3d"2"\x3e\r\n            \x3cinput data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-point\x3d"classifyIntervalInput" class\x3d"esriRenderingRuleClassifySelect" \r\n            data-dojo-attach-event\x3d"onChange: _updateClassifyGrid"\x3e\x3c/input\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n      \x3ctbody data-dojo-attach-point\x3d"uniqueValuesBlock"\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"uniqueValuesFieldBlock"\x3e\r\n          \x3ctd\x3e\r\n            \x3clabel data-dojo-attach-point\x3d"uniqueValuesFieldLabel"\x3e${_i18n.widgets.renderingRule.fieldLabel}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd colspan\x3d"2"\x3e\r\n            \x3cinput data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"uniqueValuesFieldSelect" \r\n            class\x3d"esriRenderingRuleUniqueValuesSelect" data-dojo-props\x3d"labelAttr: \'alias\'" data-dojo-attach-event\x3d"onChange: _updateUniqueValuesGrid"\x3e\x3c/input\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"colorRampLabelBlock"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3cdiv class\x3d"esriRenderingRuleColorRampHeading"\x3e${_i18n.widgets.renderingRule.colorRampTitle}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"colorRampBlock"\x3e\r\n        \x3ctd colspan\x3d"3" \x3e\r\n          \x3cselect data-dojo-attach-point\x3d"colorRampSelect" data-dojo-type\x3d"esri/dijit/ColorRampSelector" class\x3d"esriRenderingRuleColorRampList dijitSelect" \r\n          data-dojo-props\x3d"dropDownPosition: [\'below\'], maxHeight: 200" data-dojo-attach-event\x3d"onChange: _onColorRampChange"\x3e\x3c/select\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"classifyGridBlock"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\x3cdiv data-dojo-attach-point\x3d"classifyGrid"\x3e\x3c/div\x3e\x3c/td\x3e\r\n      \x3c/tr\x3e   \r\n      \x3ctr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"uniqueValuesGridBlock"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\x3cdiv data-dojo-attach-point\x3d"uniqueValuesGrid"\x3e\x3c/div\x3e\x3c/td\x3e\r\n      \x3c/tr\x3e   \r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3ccenter\x3e\x3cinput type\x3d"button" data-dojo-attach-point\x3d"_apply" value\x3d"APPLY" size\x3d"15" class\x3d"esriRenderingRuleApplyButton" /\x3e\x3c/center\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e      \r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e'}});
define("esri/dijit/RenderingRule","dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/dom-style dojo/dom-class dojo/dom-construct dojo/i18n!../nls/jsapi dojo/text!./templates/RenderingRule.html dojo/store/Memory dojo/store/Observable dojo/data/ObjectStore dojo/has dojo/on dojo/Deferred ../kernel ../lang ../layers/RasterFunction ../geometry/Extent ../geometry/Point ./ColorRampSelector ../renderers/colorUtils ./ColorPicker ../tasks/generateRenderer ../tasks/AlgorithmicColorRamp ../tasks/MultipartColorRamp ../symbols/SimpleFillSymbol ../Color ../renderers/StretchRenderer ../renderers/UniqueValueRenderer ../renderers/ClassBreaksRenderer ../renderers/colorRampUtils dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/popup dijit/Tooltip dgrid/OnDemandGrid dgrid/editor dgrid/Keyboard dijit/form/NumberTextBox dijit/form/TextBox dijit/form/HorizontalSlider dijit/form/HorizontalRuleLabels dijit/form/FilteringSelect".split(" "),
function(z,f,q,h,t,p,A,N,B,m,O,H,P,I,Q,R,C,w,S,T,fa,D,U,J,K,V,L,x,W,X,Y,Z,aa,ba,ca,E,da,F,y,G,ea,M){B=z([aa,ba,ca],{declaredClass:"esri.dijit.RenderingRule",templateString:B,widgetsInTemplate:!0,layer:null,map:null,hideApplyButton:!1,_renderingRuleObject:null,_rasterFunctionData:[],_rasterFunctionStore:null,_cachedFunctionList:[],_cachedkeyProperties:{},_cachedHistogramsList:{},_cachedRATList:{},_pendingDfds:{},_redBandIdStore:null,_greenBandIdStore:null,_blueBandIdStore:null,_donotSaveChanges:!1,
_resetBandCombination:!1,_serviceBandCount:3,_defaultBandCombinationFncName:"User Defined Renderer",_firstFncInRenderingRuleList:null,_gammaSliderTooltip:null,_symbologyTypes:{classify:"classify",stretch:"stretch",uniqueValues:"uniqueValues"},_uniqueValuesColorRampName:"Unique Values Default",_classifyMethods:{naturalBreaks:"natural-breaks",equalInterval:"equal-interval",quantile:"quantile",definedInterval:"defined-interval"},constructor:function(a){z.safeMixin(this,a);this._i18n=N;this._defaultBandCombinationFncName=
this._i18n.widgets.renderingRule.userDefinedRendererTitle;this._renderingRuleObject=new w},startup:function(){this.inherited(arguments);q.connect(this.rasterFunctionList,"onChange",f.hitch(this,"_onRasterFunctionChange"));q.connect(this.stretchMethodList,"onChange",f.hitch(this,"_onStretchMethodChange"));q.connect(this.gammaSlider,"onChange",f.hitch(this,"_onGammaChange"));q.connect(this.gammaSlider,"onMouseLeave",f.hitch(this,"_onGammaMouseLeave"));q.connect(this._apply,"onclick",f.hitch(this,"_onClickApplyRenderingRule"));
q.subscribe("onRenderingRuleApply",f.hitch(this,"_onClickApplyRenderingRule"));q.subscribe("onRenderingRuleReset",f.hitch(this,"_onClickResetRenderingRule"));this.hideApplyButton&&(this._apply.style.display="none");this._setupUniqueValuesGrid();this._setupClassifyGrid();this._setupStretchStatsGrid();this._setupClassifyMethodStore();this._symbologyBlocks=[this.stretchBlock,this.colorRampBlock,this.classifyBlock,this.classifyGridBlock,this.uniqueValuesBlock,this.uniqueValuesGridBlock]},_getColorMapFunction:function(a){a=
new w;a.functionArguments=this.colorRampSelect.colorRampName?{colorRamp:this.colorRampSelect.colorRampName}:{Colormap:this.colorRampSelect.colorMap};a.variableName="Raster";a.functionName="Colormap";return a},destroy:function(){this._pendingDfds=null;this._gammaSliderTooltip&&(this._gammaSliderTooltip.destroy(),this._gammaSliderTooltip=null);this.inherited(arguments)},_setLayerAttr:function(a){if(a){this.inherited(arguments);this.layer=a;this._donotSaveChanges=!0;this._firstFncInRenderingRuleList=
null;this._stretchReadFromRenderingRule=!1;this._fillStretchMethodList();this._hideStretch();var b=f.hitch(this,"_setupDefaults");this.layer.loaded?this._setupDefaults():q.connect(this.layer,"onLoad",b);this._donotSaveChanges=!1}},_setupDefaults:function(){this._setupBandIdDefaults();this._setupStretchDefaults();this._setupRenderingRuleDefaults();this._setupColorRampDefaults();this._setupSymbologyDefaults();this._setupClassifyDefaults();this._setupUniqueValuesDefaults()},_setupRFTDefaults:function(){this._setupColorRampDefaults();
this._setupStretchDefaults();this._setupSymbologyDefaults();this._setupClassifyDefaults();this._setupUniqueValuesDefaults()},_setupRenderingRuleDefaults:function(){if(this.layer){this._rasterFunctionData=[];var a=new Q,b;for(b=0;b<this._cachedFunctionList.length;b++){var c=this._cachedFunctionList[b];if(c&&this.layer===c.layer)return this._rasterFunctionData=c.data,this._setupFunctionStore(),a.resolve(),a}return this._fillRasterFunctionList(this.layer)}},_setupClassifyDefaults:function(){if(this.layer&&
this.symbologyTypeSelect.store.get(this._symbologyTypes.classify)){this._setupClassifyMethodStore();this._setupClassifyNClassesInput();this._setupClassifyGridDefaults();this._setupClassifyFieldStore();var a=this.layer,b=this.layer.id,c=this._rasterFunctionStore.get(this.rasterFunctionList.value),d=c.name,e=c&&c.serviceInfo,c=e?e.hasRasterAttributeTable:this.layer.hasRasterAttributeTable,e=e?e.hasHistograms:this.layer.hasHistograms,g=d===this._defaultBandCombinationFncName?null:new w({functionName:d});
this._cachedRATList[b]&&this._cachedRATList[b][d]?this._handleRasterAttributeTableClassify(this._cachedRATList[b][d]):c?this.rasterFunctionList.value===this._defaultBandCombinationFncName?a.getRasterAttributeTable().then(f.hitch(this,this._handleRasterAttributeTableClassify)):a.getRenderingRuleAttributeTable({renderingRule:g}).then(f.hitch(this,this._handleRasterAttributeTableClassify)):this._cachedHistogramsList&&this._cachedHistogramsList[b]&&this._cachedHistogramsList[b][d]?this._handleHistogramsResultClassify(this._cachedHistogramsList[this.layer.id][d]):
e&&this.rasterFunctionList.value===this._defaultBandCombinationFncName?a.getHistograms().then(f.hitch(this,this._handleHistogramsResultClassify)):10.1<a.currentVersion&&a.computeHistograms({renderingRule:g,pixelSize:this._getOverviewPixelSize()}).then(f.hitch(this,this._handleHistogramsResultClassify))}},_getOverviewPixelSize:function(){var a=this.layer.extent;return new T((a.xmax-a.xmin)/this.map.width,(a.ymax-a.ymin)/this.map.height,a.spatialReference)},_addUniqueValuesColorRamp:function(a){var b=
{},c;(a=a.features)&&a.length&&C.isDefined(a[0].attributes.Red)&&C.isDefined(a[0].attributes.Green)&&C.isDefined(a[0].attributes.Blue)&&(b.id=this._uniqueValuesColorRampName,b.name=this._uniqueValuesColorRampName,b.type="multipart",b.colorRamps=[],h.forEach(a,function(a){c=a.attributes;b.colorRamps.push({fromColor:[c.Red,c.Green,c.Blue],toColor:[c.Red,c.Green,c.Blue]})}),this._uniqueValuesColorRamp=b,this._setColorRampSelectValue())},_handleRasterAttributeTableClassify:function(a){if(a&&a.features&&
a.features.length){var b=this.rasterFunctionList.value;this._cachedRATList[this.layer.id]=this._cachedRATList[this.layer.id]||{};this._cachedRATList[this.layer.id][b]=a;this._setDefaultIntervalSize();this._addUniqueValuesColorRamp(a);this._setupClassifyFieldStore();this._setupUniqueValuesFieldStore();this.symbologyTypeSelect.set("value",this._getDefaultSymbologyType());this._isClassBreaksRenderer(this.layer.renderer)||this._updateClassifyGrid();this._isUniqueValueRenderer(this.layer.renderer)||this._updateUniqueValuesGrid()}},
_handleHistogramsResultClassify:function(a){if(a&&a.histograms&&a.histograms.length){a=a.histograms;var b=this.rasterFunctionList.value;this._cachedHistogramsList[this.layer.id]=this._cachedHistogramsList[this.layer.id]||{};this._cachedHistogramsList[this.layer.id][b]=a;this._setDefaultIntervalSize();var b=0,c,d,e,g=[];if(a&&a.length&&a[0].size){c=a[0].counts;d=a[0].min;e=a[0].max;for(b=0;b<c.length;b++)g.push(d+(e-d)*b/c.length);a[0].dataPoints=g}this._isClassBreaksRenderer(this.layer.renderer)||
this._updateClassifyGrid()}},_setDefaultIntervalSize:function(){if(this.layer){var a=this.layer,b=a.id,c=a.renderer,d,e,g,r=this.rasterFunctionList.value,k,f=this.classifyFieldSelect.value;this._isSelectedRenderingRule(a.renderingRule)&&this._isClassBreaksRenderer(c)&&c.infos&&c.infos.length&&c.attributeField===f&&(a=c.infos[0],d=a.maxValue-a.minValue);d||(this._cachedRATList&&this._cachedRATList[b]&&this._cachedRATList[b][r]?(b=this._cachedRATList[b][r],e=g=b.features[0].attributes[f],h.forEach(b.features,
function(a){k=a.attributes[f];k<e&&(e=k);k>g&&(g=k)})):this._cachedHistogramsList&&this._cachedHistogramsList[b]&&this._cachedHistogramsList[b][r]&&(b=this._cachedHistogramsList[b][r],e=b[0].min,g=b[0].max),b=this.classifyNClassesInput&&this.classifyNClassesInput.value||4,d=(g-e)/b);this.classifyIntervalInput.attr("value",d,!1)}},_setupUniqueValuesDefaults:function(){this.layer&&this.symbologyTypeSelect.store.get(this._symbologyTypes.uniqueValues)&&this._setupUniqueValuesGridDefaults()},_setupSymbologyDefaults:function(){this._setupSymbologyStore();
this._setSymbologySelectVisibility()},_setSymbologySelectVisibility:function(){var a=this._canApplyRenderer();p.toggle(this.symbologyTypeBlock,"esriRenderingRuleHidden",!a);p.toggle(this.symbologyTypeBlock,"esriRenderingRuleVisible",a)},_setupSymbologyStore:function(){if(this.layer){var a=this._rasterFunctionStore&&this._rasterFunctionStore.get(this.rasterFunctionList.value),b=a&&a.serviceInfo?a.serviceInfo:null,a=this.layer.renderer,c=[],d=this.layer,e=b?b.bandCount:d.bandCount,b=b?b.hasRasterAttributeTable:
d.hasRasterAttributeTable;this._canApplyRenderer()&&(c.push({name:this._symbologyTypes.stretch}),e&&1===e&&(b?(c.push({name:this._symbologyTypes.uniqueValues}),c.push({name:this._symbologyTypes.classify})):10.3<=d.currentVersion&&c.push({name:this._symbologyTypes.classify})));this._isSelectedRenderingRule(d.renderingRule)&&(this._isUniqueValueRenderer(a)&&!h.some(c,function(a){return a.name===this._symbologyTypes.uniqueValues},this)&&c.push({name:this._symbologyTypes.uniqueValues}),this._isClassBreaksRenderer(a)&&
!h.some(c,function(a){return a.name===this._symbologyTypes.classify},this)&&c.push({name:this._symbologyTypes.classify}));h.forEach(c,function(a){a.label=this._i18n.widgets.renderingRule[a.name+"Label"];a.id=a.name},this);this.symbologyTypeSelect.set("store",new m({data:c}));(this.symbologyType=this._getDefaultSymbologyType())&&this.symbologyTypeSelect.set("value",this.symbologyType);this._onSymbologyTypeChange(this.symbologyType)}},_canApplyRenderer:function(){if(this.layer){var a=this.rasterFunctionList.value;
return 10.3<=this.layer.currentVersion||a===this._defaultBandCombinationFncName}},_setupUniqueValuesFieldStore:function(){if(this.layer){var a=new m({data:this._getRasterAttributeTableFields()});a&&this.uniqueValuesFieldSelect&&this.uniqueValuesFieldSelect.set("store",a);a=this._isUniqueValueRenderer(this.layer.renderer)?this.layer.renderer.attributeField:(a=a.query({name:"ClassName"}))&&a.length?"ClassName":"Value";this.uniqueValuesFieldSelect.attr("value",a,!1)}},_setupStretchStatsGrid:function(){var a=
this._i18n.widgets.renderingRule,b={sortable:!1,editor:ea,editOn:"click",autoSave:!0,renderCell:f.hitch(this,this._stretchStatsRenderCell),canEdit:f.hitch(this,function(){return"6"!==this.stretchMethodList.value})};this._stretchStatsGrid=new (z([F,G]))({selectionMode:"single",className:"dgrid-autoheight",columns:[y(f.mixin({field:"esriRenderingRuleStretchMin",label:a.minLabel},b)),y(f.mixin({field:"esriRenderingRuleStretchMax",label:a.maxLabel},b)),y(f.mixin({field:"esriRenderingRuleStretchMean",
label:a.meanLabel},b)),y(f.mixin({field:"esriRenderingRuleStretchStdv",label:a.stdDevLabel},b))]},this.stretchStatsGrid);this._stretchStatsGrid.startup()},_stretchStatsRenderCell:function(a,b,c){null===b||void 0===b||isNaN(b)?c.innerHTML="":c.innerHTML=Math.round(1E4*b)/1E4},_setupUniqueValuesGrid:function(){this._uniqueValuesGrid=new (z([F,G]))({selectionMode:"single",columns:[{field:"esriRenderingRuleUniqueValuesSymbol",sortable:!1,renderCell:f.hitch(this,function(a,b,c){a=A.toDom('\x3cdiv class \x3d esriRenderingRuleSymbolCell style \x3d "background: rgba( '+
a.esriRenderingRuleUniqueValuesSymbol.r+", "+a.esriRenderingRuleUniqueValuesSymbol.g+", "+a.esriRenderingRuleUniqueValuesSymbol.b+","+255*a.esriRenderingRuleUniqueValuesSymbol.a+') " id \x3d EsriRenderingRuleUniqueValuesGrid'+a.id+"\x3e\x3c/div\x3e");A.place(a,c);a.onclick=f.hitch(this,function(a){this._openColorPickerPopup(a)})}),label:this._i18n.widgets.renderingRule.symbolLabel},{field:"esriRenderingRuleUniqueValuesValue",label:this._i18n.widgets.renderingRule.valueLabel},y({field:"esriRenderingRuleUniqueValuesLabel",
sortable:!1,label:this._i18n.widgets.renderingRule.labelLabel,editor:M,editOn:"click",autoSave:!0})]},this.uniqueValuesGrid);this._uniqueValuesGrid.startup()},_setupClassifyGrid:function(){this._classifyGrid=new (z([F,G]))({className:"dgrid-autoheight",columns:[{field:"esriRenderingRuleClassifySymbol",sortable:!1,renderCell:f.hitch(this,function(a,b,c){a=A.toDom('\x3cdiv class \x3d esriRenderingRuleSymbolCell style \x3d "background: rgba( '+a.esriRenderingRuleClassifySymbol.r+", "+a.esriRenderingRuleClassifySymbol.g+
", "+a.esriRenderingRuleClassifySymbol.b+","+255*a.esriRenderingRuleClassifySymbol.a+') " id \x3d EsriRenderingRuleEditorClassifyGrid'+a.id+"\x3e\x3c/div\x3e");A.place(a,c);a.onclick=f.hitch(this,function(a){this._openColorPickerPopup(a)})}),label:this._i18n.widgets.renderingRule.symbolLabel},{field:"esriRenderingRuleClassifyValue",label:this._i18n.widgets.renderingRule.valueLabel,sortable:!1,renderCell:function(a,b,c){c.innerHTML="\u2264 "+Math.floor(1E3*a.maxValue)/1E3}},y({field:"esriRenderingRuleClassifyLabel",
label:this._i18n.widgets.renderingRule.labelLabel,editor:M,editOn:"click",autoSave:!0,sortable:!1})]},this.classifyGrid);this._classifyGrid.startup()},_setupClassifyGridDefaults:function(){if(this.layer&&this._isClassBreaksRenderer(this.layer.renderer)){var a=[];h.forEach(this.layer.renderer.infos,function(b){a.push({minValue:b.minValue,maxValue:b.maxValue,esriRenderingRuleClassifySymbol:b.symbol.color,esriRenderingRuleClassifyLabel:b.label})});this._updateClassifyGrid(a)}},_setupUniqueValuesGridDefaults:function(){if(this.layer&&
this._isUniqueValueRenderer(this.layer.renderer)){var a=[];h.forEach(this.layer.renderer.infos,function(b){a.push({esriRenderingRuleUniqueValuesValue:b.value,esriRenderingRuleUniqueValuesSymbol:b.symbol.color,esriRenderingRuleUniqueValuesLabel:b.label||b.value})});this._updateUniqueValuesGrid(a)}},_setupClassifyNClassesInput:function(){if(this.layer){var a=this._isClassBreaksRenderer(this.layer.renderer)?this.layer.renderer.infos.length:5;this.classifyNClassesInput.attr("value",a,!1)}},_isSelectedRenderingRule:function(a){var b=
this._getStretchRenderingRule(a),c=this.rasterFunctionList.value;if(!a){if(this.rasterFunctionList.value===this._defaultBandCombinationFncName)return!0}else if(b){if((a=b.functionArguments)&&this._isSelectedRenderingRule(a.Raster))return!0}else if(a.functionName.toLowerCase()===c.toLowerCase())return!0},_isUniqueValueRenderer:function(a){return a&&"esri.renderer.UniqueValueRenderer"===a.declaredClass},_isClassBreaksRenderer:function(a){return a&&"esri.renderer.ClassBreaksRenderer"===a.declaredClass},
_isStretchRenderer:function(a){return a&&"esri.renderer.StretchRenderer"===a.declaredClass},_getStretchRenderingRule:function(a){if(a){if(a&&a.functionName&&"stretch"===a.functionName.toLowerCase())return a;if(a&&a.functionName&&"colormap"===a.functionName.toLowerCase()&&a.functionArguments&&a.functionArguments.Raster&&a.functionArguments.Raster.functionName&&"stretch"===a.functionArguments.Raster.functionName.toLowerCase())return a=a.functionArguments.Raster}},_setupClassifyMethodStore:function(){if(this.layer){var a=
[],b=this._isClassBreaksRenderer(this.layer.renderer)?this.layer.renderer.classificationMethod:this._classifyMethods.equalInterval,c;for(c in this._classifyMethods)this._classifyMethods.hasOwnProperty(c)&&a.push({label:"\x3cdiv class\x3d 'esriRenderingRuleFilteringSelectLabel'\x3e\x3ch4 style\x3d'font-weight:bold;'\x3e"+this._i18n.widgets.renderingRule[c]+"\x3c/h4\x3e\x3cbr/\x3e\x3ci\x3e"+this._i18n.widgets.renderingRule[c+"Desc"]+"\x3c/i\x3e\x3c/div\x3e",id:this._classifyMethods[c],name:this._i18n.widgets.renderingRule[c]});
this.classifyMethodSelect.set("store",new m({data:a}));this.classifyMethodSelect.set("labelType","html");this.classifyMethodSelect.set("labelAttr","label");this.classifyMethodSelect.attr("value",b,!1);this._handleClassifyIntervalVisibility(b)}},_setupClassifyFieldStore:function(){if(this.layer){var a;a=this._i18n.widgets.renderingRule.valueLabel;var b=this._isClassBreaksRenderer(this.layer.renderer)?this.layer.renderer.attributeField:"Value";a=this.layer&&this.layer.rasterAttributeTable?this._getRasterAttributeTableFields(!0):
[{name:a,alias:a,id:"Value"}];this.classifyFieldSelect.set("store",new m({data:a}));this.classifyFieldSelect.attr("value",b,!1)}},_getRasterAttributeTableFields:function(a){if(this.layer){var b=this.layer.id,c=this.rasterFunctionList.value;if(b=this._cachedRATList[b]&&this._cachedRATList[b][c]||this.layer.rasterAttributeTable)return b=f.clone(b.fields),b=h.filter(b,function(b){if("esriFieldTypeOID"!==b.type&&(!a||"esriFieldTypeString"!==b.type))return!0}),b=h.map(b,function(a){a.id=a.name;return a})}},
_setupFunctionStore:function(){if(this.layer){this._rasterFunctionStore=new m({data:this._rasterFunctionData,idProperty:"name"});this.rasterFunctionList.set("store",this._rasterFunctionStore);this.rasterFunctionList.set("labelAttr","label");this.rasterFunctionList.set("labelType","html");var a=this.layer.rasterFunctionInfos;a&&0<a.length&&a[0].name&&(this._firstFncInRenderingRuleList=a[0].name);var a=this.layer.renderingRule,b="";(b=a&&a.functionName?"stretch"!==a.functionName.toLowerCase()&&"colormap"!==
a.functionName.toLowerCase()?a.functionName:this._getRenderingRuleNameFromStretchFunction(a)||this._defaultBandCombinationFncName:this._firstFncInRenderingRuleList&&"none"!==this._firstFncInRenderingRuleList.toLowerCase()&&!this.layer.bandIds?this._firstFncInRenderingRuleList:this._defaultBandCombinationFncName)&&(this._rasterFunctionStore.get(b)||"Colormap"===b)&&(this.rasterFunctionList.set("value",b),this._onRasterFunctionChange())}else console.log("Could not populate renderers as the layer does not exists")},
_fillRasterFunctionList:function(a){if(this.layer&&(this._rasterFunctionData=[],null!==a&&null!==a.extent)){var b=new S(a.extent.xmin,a.extent.ymin,a.extent.xmax,a.extent.ymax,a.extent.spatialReference),c=b.getWidth(),d=b.getHeight();if(2<=c/d||2<=d/c)c=Math.min(c,d)/2,d=b.getCenter(),b.update(d.x-c,d.y-c,d.x+c,d.y+c,a.extent.spatialReference);b=b.xmin+","+b.ymin+","+b.xmax+","+b.ymax;c=a._getToken();d="";c&&(d="\x26token\x3d"+c);var e=this.layer.url+"/exportImage?bbox\x3d"+b+d+"\x26imageSize\x3d400,400\x26f\x3dimage\x26renderingRule\x3d",
b=this.layer.bandIds,c=e;b&&3<=b.length&&(c=e+"\x26bandIds\x3d"+b[0]+","+b[1]+","+b[2]);this._addFunctionItemToList(this._defaultBandCombinationFncName,this._defaultBandCombinationFncName,this._i18n.widgets.renderingRule.userDefinedRendererDesc,c,"");a.rasterFunctionInfos&&0<a.rasterFunctionInfos.length&&h.forEach(a.rasterFunctionInfos,f.hitch(this,function(a){"none"!==a.name.toLowerCase()&&this._addFunctionItemToList(a.name,a.name,a.description,e,'{"rasterFunction":"'+a.name+'"}')}));a={};a.layer=
this.layer;a.data=this._rasterFunctionData;this._cachedFunctionList.push(a);var g;h.forEach(this.layer.rasterFunctionInfos,function(a){g=new w({rasterFunction:a.name});this.layer.getRenderingRuleServiceInfo(g).then(f.hitch(this,function(b){h.some(this._rasterFunctionData,function(c,d){if(c.name===a.name)return this._rasterFunctionData[d].serviceInfo=b,a.name===this.rasterFunctionList.value&&this._setupRFTDefaults(),!0},this)}))},this);this._setupFunctionStore()}},_addFunctionItemToList:function(a,
b,c,d,e){var g={};g.name=a;g.id=b;b=c;200<b.length&&(b=b.substring(0,200)+"...");g.description=b;g.label="\x3chtml\x3e\x3cbody\x3e\x3csection\x3e\x3ch4\x3e"+a+":\x3c/h4\x3e\x3ctable cellspacing\x3d'5'\x3e\x3ctr\x3e\x3ctd\x3e\x3cimg src\x3d'"+d+e+"' height\x3d'100' width\x3d'100'\x3e\x3c/td\x3e\x3ctd\x3e\x3cp style\x3d'white-space:pre-wrap;width:40ex'\x3e\x3ci\x3e"+b+"\x3c/i\x3e\x3c/p\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/section\x3e\x3c/body\x3e\x3c/html\x3e";this._rasterFunctionData.push(g)},
_setupColorRampDefaults:function(){this.layer&&this._setColorRampVisibility()},_setColorRampVisibility:function(){var a;this._rasterFunctionStore&&(a=this._rasterFunctionStore.get(this.rasterFunctionList.value).serviceInfo);if(!this._canApplyRenderer())return this._hideColorRampSelector();if(this.symbologyType===this._symbologyTypes.stretch){var b=a&&a.bandCount?a.bandCount:this.layer.bandCount;a=a&&a.pixelType?a.pixelType:this.layer.pixelType;var c=this.layer.renderer,d=this.layer.renderingRule,
e=this._getStretchRenderingRule(d);if(this._isSelectedRenderingRule(this.layer.renderingRule)&&(this._isStretchRenderer(c)&&c.colorRamp&&c.stretchType==this.stretchMethodList.value||d&&d.functionName&&"colormap"===d.functionName.toLowerCase()&&(e&&e.StretchType)===this.stretchMethodList.value))return this._showColorRampSelector();1<b||10.3>this.layer.currentVersion||"u8"!==a.toLowerCase()&&"0"===this.stretchMethodList.value?this._hideColorRampSelector():this._showColorRampSelector()}else this._showColorRampSelector()},
_setColorRampSelectValue:function(){if(this.layer){var a=this.layer.renderer,b=this.layer.renderingRule;this.symbologyType===this._symbologyTypes.stretch?(this.colorRampSelect.removeColorRamp(this._uniqueValuesColorRamp),this._isStretchRenderer(a)&&this._isSelectedRenderingRule(this.layer.renderingRule)?this.colorRampSelect.setSelected(a.colorRamp):b&&b.functionName&&"colormap"===b.functionName.toLowerCase()&&b.functionArguments&&b.functionArguments.colorRamp?this.colorRampSelect.setSelected(b.functionArguments.colorRamp):
this._setStretchColorRamp()):(b=a&&a.authoringInfo&&a.authoringInfo.colorRamp?Z.fromJson(f.clone(a.authoringInfo.colorRamp)):null,this.symbologyTypeSelect.value===this._symbologyTypes.uniqueValues?(this.colorRampSelect.addColorRamp(this._uniqueValuesColorRamp),this._isUniqueValueRenderer(a)&&b?this.colorRampSelect.setSelected(b):this._setUniqueValuesColorRamp()):this.symbologyTypeSelect.value===this._symbologyTypes.classify&&(this.colorRampSelect.removeColorRamp(this._uniqueValuesColorRamp),this._isClassBreaksRenderer(a)&&
b?this.colorRampSelect.setSelected(b):this._setClassifyColorRamp()))}},_hideColorRampSelector:function(){t.set(this.colorRampBlock,"display","none");t.set(this.colorRampLabelBlock,"display","none");this._colorRampVisible=!1},_showColorRampSelector:function(){this.layer&&(this._setColorRampSelectValue(),t.set(this.colorRampBlock,"display","table-row"),t.set(this.colorRampLabelBlock,"display","table-row"),this._colorRampVisible=!0)},_getDefaultSymbologyType:function(){if(this.layer){if(this._isSelectedRenderingRule(this.layer.renderingRule)){if(this.layer.renderer&&
this.layer.renderer.declaredClass){var a=this.layer.renderer.declaredClass;if("esri.renderer.StretchRenderer"===a)return this._symbologyTypes.stretch;if("esri.renderer.ClassBreaksRenderer"===a)return this._symbologyTypes.classify;if("esri.renderer.UniqueValueRenderer"===a)return this._symbologyTypes.uniqueValues}if(this.layer.renderingRule&&((a=this.layer.renderingRule)&&a.functionName&&"stretch"===a.functionName.toLowerCase()||a&&a.functionName&&"colormap"===a.functionName.toLowerCase()&&a.functionArguments&&
a.functionArguments.Raster&&a.functionArguments.Raster.functionName&&"stretch"===a.functionArguments.Raster.functionName.toLowerCase()))return this._symbologyTypes.stretch}if(this._cachedRATList[this.layer.id]&&this._cachedRATList[this.layer.id][this.rasterFunctionList.value]&&(a=this._cachedRATList[this.layer.id][this.rasterFunctionList.value],a.features[0]&&a.features[0].attributes.Red))return this._symbologyTypes.uniqueValues;if(this._canApplyRenderer())return this._symbologyTypes.stretch}},_setupBandIdDefaults:function(){if(this.layer){var a=
3,a=this.layer.bandCount,b=this.layer.id,c=this._cachedkeyProperties[b];!c&&1<a?(this.msgLabel.style.display="",this.msgLabel.innerHTML="\x3ci\x3e"+this._i18n.widgets.renderingRule.bandNamesRequestMsg+"\x3c/i\x3e",c=this.layer.getKeyProperties(),this._pendingDfds[b]=1,c.addBoth(f.partial(this._fillBandIdList,this,this.layer))):this._fillBandIdList(this,this.layer,c);3>a?this._hideBandIds():this._showBandIds()}},_fillBandIdList:function(a,b,c){if(a.layer&&a.layer===b){var d=a._pendingDfds;b=a.layer.id;
d&&d[b]&&delete d[b];a.msgLabel.style.display="none";a.msgLabel.innerHTML="";var d=3,d=a.layer.bandCount,e;c&&c.BandProperties&&0<c.BandProperties.length&&(e=c.BandProperties);var g=a._getBandIdList(d,e,"");a._redBandIdStore=new m({data:g,idProperty:"name"});a.bandIdsRedList.set("store",a._redBandIdStore);a.bandIdsRedList.set("labelAttr","label");a.bandIdsRedList.set("labelType","html");g=a._getBandIdList(d,e,"");a._greenBandIdStore=new m({data:g,idProperty:"name"});a.bandIdsGreenList.set("store",
a._greenBandIdStore);a.bandIdsGreenList.set("labelAttr","label");a.bandIdsGreenList.set("labelType","html");d=a._getBandIdList(d,e,"");a._blueBandIdStore=new m({data:d,idProperty:"name"});a.bandIdsBlueList.set("store",a._blueBandIdStore);a.bandIdsBlueList.set("labelAttr","label");a.bandIdsBlueList.set("labelType","html");(d=a.layer.bandIds)&&2<d.length?(a.bandIdsRedList.attr("value",a._getBandName(a._redBandIdStore,d[0]),!1),a.bandIdsGreenList.attr("value",a._getBandName(a._greenBandIdStore,d[1]),
!1),a.bandIdsBlueList.attr("value",a._getBandName(a._blueBandIdStore,d[2]),!1)):0<a._redBandIdStore.data.length&&1<a._greenBandIdStore.data.length&&2<a._blueBandIdStore.data.length&&(d=a._getRedBandIndex(e),g=a._getGreenBandIndex(e),e=a._getBlueBandIndex(e),a.bandIdsRedList.attr("value",a._redBandIdStore.data[d].name,!1),a.bandIdsGreenList.attr("value",a._greenBandIdStore.data[g].name,!1),a.bandIdsBlueList.attr("value",a._blueBandIdStore.data[e].name,!1));a._cachedkeyProperties[b]=c;a.rasterFunctionList.get("value")===
a._defaultBandCombinationFncName&&a._enableBandIds()}},_getRedBandIndex:function(a){if(!this.layer||!a)return 0;var b;for(b=0;b<a.length;b++)if(a[b]&&a[b].hasOwnProperty("BandName")&&"red"===a[b].BandName.toLowerCase())return b;return 0},_getGreenBandIndex:function(a){if(!this.layer||!a)return 1;var b;for(b=0;b<a.length;b++)if(a[b]&&a[b].hasOwnProperty("BandName")&&"green"===a[b].BandName.toLowerCase())return b;return 1},_getBlueBandIndex:function(a){if(!this.layer||!a)return 2;var b;for(b=0;b<a.length;b++)if(a[b]&&
a[b].hasOwnProperty("BandName")&&"blue"===a[b].BandName.toLowerCase())return b;return 2},_getBandIdList:function(a,b,c){if(this.layer){var d=[];c||(c="Black");var e=!1;b&&a===b.length&&(e=!0);var g;for(g=0;g<a;g++){var r=g,k=g;e&&b[g]&&b[g].BandName?r=b[g].BandName:r++;var f={};f.name=r;f.index=k;f.label="\x3chtml\x3e\x3cbody\x3e\x3cspan value\x3d"+k+"\x3e\x3cfont color\x3d"+c+"\x3e"+r+"\x3c/font\x3e\x3c/span\x3e\x3c/body\x3e\x3c/html\x3e";d.push(f)}return d}},_getBandName:function(a,b){if(a&&a.data){var c;
for(c=0;c<a.data.length;c++){var d=a.data[c];if(d.index===b)return d.name}return""}},_setupStretchDefaults:function(){if(this.layer){var a,b=this._getStretchRenderingRule(this.layer.renderingRule);this._isSelectedRenderingRule(this.layer.renderingRule)&&(this._isStretchRenderer(this.layer.renderer)||b)?this._isStretchRenderer(this.layer.renderer)?this._loadStretchRenderer(this.layer.renderer):b&&this._loadStretchFunction(b):(this.stretchMethodList.attr("value","0",!1),this._onStretchMethodChange(),
this.numStdDevText.set("value",2),this.minPercentText.set("value",2),this.maxPercentText.set("value",2),this.gammaSlider.setValue(0),this._updateStretchStatsGrid(),b=(a=this._getCurrentServiceInfo())&&a.minValues,a=a&&a.maxValues,this.draCheckbox.checked=b&&0<b.length&&a&&0<a.length?!1:!0);this._gammaSliderTooltip||(this._gammaSliderTooltip=new da({connectId:["gammaSliderID"],position:["below","above"],id:"gammaSliderTooltipID"}))}},_loadStretchFunction:function(a){if(a&&a.functionName&&"stretch"===
a.functionName.toLowerCase()){this._stretchReadFromRenderingRule=!0;a=a.functionArguments;this.stretchMethodList.attr("value",a.StretchType.toString(),!1);this._onStretchMethodChange();a.NumberOfStandardDeviations&&this.numStdDevText.set("value",a.NumberOfStandardDeviations);this.draCheckbox.checked=a.DRA?!0:!1;if(a.UseGamma){var b=a.Gamma;0<a.Gamma.length&&(b=a.Gamma[0]);(b=Math.log(b)/Math.log(10))&&this.gammaSlider.setValue(b)}a.MinPercent&&this.minPercentText.set("value",a.MinPercent);a.MaxPercent&&
this.maxPercentText.set("value",a.MaxPercent);a.Statistics&&a.Statistics.length&&this._loadStretchStats(a.Statistics)}},_loadStretchRenderer:function(a){if(this._isStretchRenderer(a)){this._stretchReadFromRenderingRule=!1;var b=a._convertStretchTypeEnumToIndex(a.stretchType);this.stretchMethodList.set("value",b.toString());this._onStretchMethodChange();a.numberOfStandardDeviations&&this.numStdDevText.set("value",a.numberOfStandardDeviations);this.draCheckbox.checked=a.dra?!0:!1;a.useGamma&&(b=a.gamma,
0<a.gamma.length&&(b=a.gamma[0]),(b=Math.log(b)/Math.log(10))&&this.gammaSlider.setValue(b));a.minPercent&&this.minPercentText.set("value",a.minPercent);a.maxPercent&&this.maxPercentText.set("value",a.maxPercent);a.statistics&&a.statistics.length&&this._loadStretchStats(a.statistics)}},_loadStretchStats:function(a){if(a&&a.length){var b=[];h.forEach(a,function(a){a&&a.length&&b.push({esriRenderingRuleStretchMin:a[0],esriRenderingRuleStretchMax:a[1],esriRenderingRuleStretchMean:a[2],esriRenderingRuleStretchStdv:a[3]})});
this._updateStretchStatsGrid(b);this._setStretchStatsGridVisibility()}},_getRenderingRuleNameFromStretchFunction:function(a){if(a&&a.functionName&&"stretch"===a.functionName.toLowerCase())return(a=a.functionArguments.Raster)&&a.functionName||null},_fillStretchMethodList:function(){this.stretchMethodList.removeOption(this.stretchMethodList.getOptions());this.stretchMethodList.addOption([{value:"0",label:this._i18n.widgets.renderingRule.noneStretchAlias},{value:"5",label:this._i18n.widgets.renderingRule.minMaxStretchAlias},
{value:"3",label:this._i18n.widgets.renderingRule.stdDevStretchAlias},{value:"6",label:this._i18n.widgets.renderingRule.percentClipStretchAlias}]);this.stretchMethodList.set("value","0");this._onStretchMethodChange()},_onDRAChange:function(){this.symbologyType===this._symbologyTypes.stretch&&"0"!==this.stretchMethodList.value&&(this._updateStretchStatsGrid(),this._setStretchStatsGridVisibility())},_setStretchStatsGridVisibility:function(){var a=this.stretchMethodList.value,b="0"!==a&&!this.draCheckbox.checked&&
this._stretchStatsData&&this._stretchStatsData.length?"":"none";p.toggle(this.stretchStatsBlock,"esriRenderingRuleDisabledGrid","6"===a);this.stretchStatsBlock.style.display=b},_getCurrentServiceInfo:function(){var a=this._rasterFunctionStore&&this._rasterFunctionStore.get(this.rasterFunctionList.value);return this.rasterFunctionList.value===this._defaultBandCombinationFncName?this.layer:a&&a.serviceInfo?a.serviceInfo:this.layer},_updateStretchStatsGrid:function(a){if(this._stretchStatsGrid){if(!a||
"number"===typeof a||"string"===typeof a){var b=this._getCurrentServiceInfo(),c=b&&b.bandCount,d={},e=0,g=1,f=2,k,l,u;a=[];h.forEach(["minValues","maxValues","meanValues","stdvValues"],function(a){d[a]=b&&b[a]?b[a]:this.layer[a]?this.layer[a]:Array(c)},this);this.rasterFunctionList.value===this._defaultBandCombinationFncName&&3<=c&&(k=this._redBandIdStore&&this._redBandIdStore.get(this.bandIdsRedList.value),l=this._greenBandIdStore&&this._greenBandIdStore.get(this.bandIdsGreenList.value),u=this._blueBandIdStore&&
this._blueBandIdStore.get(this.bandIdsBlueList.value),e=k?k.index:e,g=l?l.index:g,f=u?u.index:f);h.forEach(3<=c?[e,g,f]:[e],function(b,c){a.push({id:c,esriRenderingRuleStretchMin:d.minValues[b],esriRenderingRuleStretchMax:d.maxValues[b],esriRenderingRuleStretchMean:d.meanValues[b],esriRenderingRuleStretchStdv:d.stdvValues[b]})})}a=this._sanitizeStretchStatsData(a);e=new H(new m({data:a,idProperty:"id"}));this._stretchStatsGrid.set("store",e);this._stretchStatsData=a}},_onSymbologyTypeChange:function(a){if(this.layer){this.symbologyType=
a;var b=this.layer.renderer,c=this.layer.renderingRule,d=this._getStretchRenderingRule(c),c=this._isSelectedRenderingRule(c);this._showBlocks([]);a===this._symbologyTypes.classify?(this._showBlocks([this.classifyBlock,this.classifyGridBlock]),this._isClassBreaksRenderer(b)&&c?this._setupClassifyGridDefaults():this._updateClassifyGrid()):a===this._symbologyTypes.uniqueValues?(this._showBlocks([this.uniqueValuesBlock,this.uniqueValuesGridBlock]),this._isUniqueValueRenderer(b)&&c?this._setupUniqueValuesGridDefaults():
this._updateUniqueValuesGrid()):a===this._symbologyTypes.stretch&&(c?this._isStretchRenderer(b)?this._loadStretchStats(b.statistics):d&&d.functionArguments?this._loadStretchStats(d.functionArguments.Statistics):this._updateStretchStatsGrid():this._updateStretchStatsGrid(),this._showBlocks([this.stretchBlock]))}},_onClassifyFieldChange:function(){this.classifyMethodSelect.value===this._classifyMethods.definedInterval&&this._setDefaultIntervalSize();this._updateClassifyGrid()},_onClassifyMethodChange:function(a){this.classifyMethodSelect.value===
this._classifyMethods.definedInterval&&this._setDefaultIntervalSize();this._handleClassifyIntervalVisibility(a);this._updateClassifyGrid()},_handleClassifyIntervalVisibility:function(a){a===this._classifyMethods.definedInterval?(t.set(this.classifyIntervalsBlock,"display","table-row"),this.classifyNClassesInput.set("disabled",!0)):(t.set(this.classifyIntervalsBlock,"display","none"),this.classifyNClassesInput.set("disabled",!1))},_showBlocks:function(a){h.forEach(this._symbologyBlocks,function(b){-1<
h.indexOf(a,b)?(p.remove(b,"esriRenderingRuleHidden"),p.add(b,"esriRenderingRuleVisible")):(p.remove(b,"esriRenderingRuleVisible"),p.add(b,"esriRenderingRuleHidden"))});this._setColorRampVisibility()},_onRasterFunctionChange:function(){var a=this.rasterFunctionList.get("value");if(a){var b=this._rasterFunctionStore.get(a).description;this._setupRFTDefaults();this.rasterFunctionList.set("title",b);b=this.layer.id;this._setColorRampVisibility();a===this._defaultBandCombinationFncName?(this.rasterFunctionRow.width=
"",1<this.layer.bandCount?(this._showBandIds(),this._pendingDfds[b]?this._disableBandIds():this._enableBandIds()):this._hideBandIds()):(0<this.domNode.clientWidth&&(this.rasterFunctionRow.width=this.domNode.clientWidth),this._hideBandIds());a===this._defaultBandCombinationFncName||10.3<=this.layer.version?(this.imageEnhancementLabel.style.display="",this.stretchMethodLabel.style.display="",this.stretchDescLabel.style.display="",this.stretchMethodList.domNode.style.display="",this._onStretchMethodChange()):
this._hideStretch()}},_setClassifyColorRamp:function(){this.colorRampSelect.setSelected("Yellow to Red")},_setUniqueValuesColorRamp:function(){this._uniqueValuesColorRamp?this.colorRampSelect.setSelected(this._uniqueValuesColorRampName):this.colorRampSelect.setSelected("Aspect")},_setStretchColorRamp:function(){this.colorRampSelect.reset()},_updateUniqueValuesGrid:function(a,b){if(this._uniqueValuesGrid&&(a=a&&a.length&&a[0].esriRenderingRuleUniqueValuesSymbol?a:this._getUniqueValuesGridData(b))&&
a.length){void 0===a[0].id&&h.forEach(a,function(a,b){a.id=b});var c=new O(new m({data:a,idProperty:"id"}));this._uniqueValuesGrid.set("store",c);this._uniqueValuesSymbolData=a}},_updateClassifyGrid:function(a,b){if(this._classifyGrid&&(a=a&&a.length&&a[0].esriRenderingRuleClassifySymbol?a:this._getClassifyGridData(b))&&a.length){var c=a[0]?a[0].maxValue-a[0].minValue:this.classifyIntervalInput.value;void 0===a[0].id&&h.forEach(a,function(a,b){a.id=b});var d=new H(new m({data:a,idProperty:"id"}));
this._classifyGrid.set("store",d);this._classifySymbolData=a;this.classifyIntervalInput.attr("value",c,!1);this.classifyNClassesInput.attr("value",a.length,!1)}},_openColorPickerPopup:function(a){if(!this._colorPickerOpen){a.stopPropagation();this._colorPicker||(this._colorPicker=new U({showTransparencySlider:!1}),this._colorPicker.startup());var b=a.target,c,d;this._colorPicker.set("color",b.style.backgroundColor,!1);E.open({popup:this._colorPicker,around:b,orient:["below","above"]});this._colorPickerOpen=
!0;c=I(document.body,"click",f.hitch(this,function(a){this._colorPicker.domNode.contains(a.target)||a.target===this._colorPicker.domNode||(d.remove(),c.remove(),E.close(this._colorPicker),this._colorPickerOpen=!1)}));d=I(this._colorPicker,"color-change",f.hitch(this,function(a){c.remove();d.remove();var e=a.color,r=this.symbologyType===this._symbologyTypes.classify?parseInt(b.id.replace("EsriRenderingRuleEditorClassifyGrid",""),10):parseInt(b.id.replace("EsriRenderingRuleUniqueValuesGrid",""),10);
E.close(this._colorPicker);this._colorPickerOpen=!1;"no-color"===e?b.style.background="rgba(0,0,0,0)":(e.a=1,b.style.background="rgba("+e.r+", "+e.g+","+e.b+", 255)");this.symbologyType===this._symbologyTypes.classify?h.some(this._classifySymbolData,f.hitch(this,function(a){if(a.id===r)return a.esriRenderingRuleClassifySymbol={r:e.r,g:e.g,b:e.b,a:e.a}})):h.some(this._uniqueValuesSymbolData,f.hitch(this,function(a){if(a.id===r)return a.esriRenderingRuleUniqueValuesSymbol={r:e.r,g:e.g,b:e.b,a:e.a}}))}))}},
_onColorRampChange:function(){if(this.symbologyType===this._symbologyTypes.uniqueValues)return this._updateUniqueValuesGrid(null,!0);if(this.symbologyType===this._symbologyTypes.classify)return this._updateClassifyGrid(null,!0)},_onStretchMethodChange:function(){if(!(1>this.stretchMethodList.getOptions.length)){var a=this.stretchMethodList.get("value");"0"===a?this._hideStretchOptions(!0):this._hideStretchOptions(!1);"6"!==a||this.draCheckbox.checked||this._updateStretchStatsGrid();this._setColorRampVisibility();
this._setStretchStatsGridVisibility();switch(a){case "0":this.stretchMethodNoneDescBlock.style.display="";break;case "3":this.numStdDevBlock.style.display="";break;case "5":this.stretchMethodMinMaxDescBlock.style.display="";break;case "6":this.minMaxPercentDescBlock.style.display="",this.minPercentBlock.style.display="",this.maxPercentBlock.style.display=""}}},_onClickApplyRenderingRule:function(){this.rasterFunctionList.get("value")!==this._defaultBandCombinationFncName?this._onRasterFunctionApply():
this._onBandIdsApply()},_onClickResetRenderingRule:function(){this.layer&&(this.layer.renderingRule=null,this.layer.bandIds=null,this.layer.renderer=null,this._setupDefaults(),this._onClickApplyRenderingRule())},_onRasterFunctionApply:function(){if(!this._donotSaveChanges&&this.layer){var a;this.layer.setBandIds([],!0);a=new w;a.functionName=this.rasterFunctionList.get("value");var b=this._getStretchFunction();10.3<=this.layer.version?this.symbologyType===this._symbologyTypes.stretch&&this._stretchReadFromRenderingRule?
b&&(b.functionArguments.Raster=a,this._colorRampVisible&&"none"!==this.colorRampSelect.value?(a=this._getColorMapFunction(),a.functionArguments.Raster=b,this.layer.setRenderingRule(a)):this.layer.setRenderingRule(b)):(this._onRendererApply(!0),this.layer.setRenderingRule(a)):(this.layer.setRenderer(null,!0),this.layer.setRenderingRule(a))}},_onBandIdsApply:function(){if(!this._donotSaveChanges&&this.layer)if(this._redBandIdStore&&this.bandIdsGreenList&&this.bandIdsBlueList){var a=[],b=this._redBandIdStore.get(this.bandIdsRedList.value),
c=this._greenBandIdStore.get(this.bandIdsGreenList.value),d=this._blueBandIdStore.get(this.bandIdsBlueList.value);b&&c&&d&&(a.push(b.index),a.push(c.index),a.push(d.index));this.layer.setRenderingRule(null,!0);this._onRendererApply(!0);this.layer.setBandIds(a)}else this.layer.setRenderingRule(null,!0),this._onRendererApply(!1)},_onRendererApply:function(a){!this._donotSaveChanges&&this.layer&&(this.symbologyType===this._symbologyTypes.classify?this._onClassifyApply(a):this.symbologyType===this._symbologyTypes.uniqueValues?
this._onUniqueValuesApply(a):this._onStretchApply(a))},_onStretchApply:function(a){if(!this._donotSaveChanges&&this.layer)if(this._stretchReadFromRenderingRule){var b=this._getStretchFunction();this._colorRampVisible&&"none"!==this.colorRampSelect.value?(a=this._getColorMapFunction(),a.functionArguments.Raster=b,this.layer.setRenderingRule(a)):this.layer.setRenderingRule(b,a)}else{if("0"===this.stretchMethodList.value&&(!this._colorRampVisible||"none"==this.colorRampSelect.value))return this.layer.setRenderer(null,
a);var b=new W,c=this.stretchMethodList.get("value");b.stretchType=b._convertStretchTypeIndexToEnum(parseInt(c,10));b.dra=this.draCheckbox.checked?!0:!1;var d=Math.exp(this.gammaSlider.value*Math.log(10)),d=parseFloat(parseFloat(d).toFixed(2)),e=[];e.push(d);1<this.layer.bandCount&&(e.push(d),e.push(d));6==c&&(b.minPercent=this.minPercentText.value,b.maxPercent=this.maxPercentText.value);3==c&&(b.numberOfStandardDeviations=this.numStdDevText.value);b.statistics=this._getStretchStats();b.gamma=e;b.useGamma=
!0;b.outputPixelType="U8";this._colorRampVisible&&"none"!==this.colorRampSelect.value&&(b.colorRamp=this._convertColorRamps(this.colorRampSelect.colorRamp,this.colorRampSelect.colorRampName));this.layer.setRenderer(b,a)}},_getStretchStats:function(){var a=this._getCurrentServiceInfo().bandCount,b=[],c=this._stretchStatsData;if(a&&!this.draCheckbox.checked&&"6"!==this.stretchMethodList.value&&"0"!==this.stretchMethodList.value&&this._isStretchGridDataValid()){var d;for(d=0;d<Math.min(a,3);d++)b.push([c[d].esriRenderingRuleStretchMin,
c[d].esriRenderingRuleStretchMax,c[d].esriRenderingRuleStretchMean,c[d].esriRenderingRuleStretchStdv]);return b}return[]},_onUniqueValuesApply:function(a){var b=new X,c=this._convertColorRamps(this.colorRampSelect.colorRamp,this.colorRampSelect.colorRampName);c&&(b.authoringInfo={},b.authoringInfo.colorRamp=c.toJson());b.infos=this._getUniqueValueInfos(this._uniqueValuesSymbolData);b.attributeField=this.uniqueValuesFieldSelect.value;this.layer.setRenderer(b,a)},_getUniqueValueInfos:function(a){var b=
[],c;h.forEach(a,function(a){c=a.esriRenderingRuleUniqueValuesSymbol;if(isNaN(c.r)||isNaN(c.g)||isNaN(c.b))c={r:0,g:0,b:0,a:0};var d=new L("solid",null,new x(c));b.push({value:a.esriRenderingRuleUniqueValuesValue,label:a.esriRenderingRuleUniqueValuesLabel.toString(),symbol:d})});return b},_getUniqueValuesColormap:function(a){var b=[];h.forEach(a,function(a){h.forEach(a.pixelValues,function(c){b.push([c,a.esriRenderingRuleUniqueValuesSymbol.r,a.esriRenderingRuleUniqueValuesSymbol.g,a.esriRenderingRuleUniqueValuesSymbol.b])})});
return b},_onClassifyApply:function(a){var b,c;c=this._convertColorRamps(this.colorRampSelect.colorRamp,this.colorRampSelect.colorRampName);b=new Y({field:this.classifyFieldSelect.value,showInAscendingOrder:!0,classificationMethod:this.classifyMethodSelect.value});c&&(b.authoringInfo={},b.authoringInfo.colorRamp=c.toJson());b.infos=this._getClassBreakInfos();b.minimumBreak=b.infos.minValue;b.attributeField=this.classifyFieldSelect.value;this.layer.setRenderer(b,a)},_getClassBreakInfos:function(){var a=
[],b,c;h.forEach(this._classifySymbolData,function(d,e){b=d.esriRenderingRuleClassifySymbol;if(isNaN(b.r)||isNaN(b.g)||isNaN(b.b))b={r:0,g:0,b:0,a:0};c=new L("solid",null,new x(b));a.push({minValue:d.minValue,maxValue:d.maxValue,label:d.esriRenderingRuleClassifyLabel,symbol:c})});return a},_getStretchFunction:function(){var a=null;"0"!==this.stretchMethodList.get("value")&&(a=new w,a.functionName="Stretch",this._buildStretchFunction(a));return a},_buildStretchFunction:function(a){a.functionName="Stretch";
var b=this.stretchMethodList.get("value"),c={};c.StretchType=parseInt(b,10);c.DRA=this.draCheckbox.checked?!0:!1;var d=Math.exp(this.gammaSlider.value*Math.log(10)),d=parseFloat(parseFloat(d).toFixed(2)),e=[];e.push(d);1<this.layer.bandCount&&(e.push(d),e.push(d));c.Gamma=e;c.UseGamma=!0;"3"===b?(c.NumberOfStandardDeviations=this.numStdDevText.value,a.outputPixelType="U8"):"6"===b?(c.MinPercent=parseFloat(this.minPercentText.value),c.MaxPercent=parseFloat(this.maxPercentText.value),a.outputPixelType=
"U8"):"5"===b&&(a.outputPixelType="U8");c.Statistics=this._getStretchStats();a.functionArguments=c},_onGammaChange:function(a){var b=this._gammaSliderTooltip;if(b&&this.symbologyTypeSelect.value===this._symbologyTypes.stretch){var c=Math.exp(a*Math.log(10));b.label=c?parseFloat(c).toFixed(2):a;b.open("gammaSliderID")}},_onGammaMouseLeave:function(){this.gammaTooltipClose()},_disableBandIds:function(){this.bandIdsRedList.set("disabled",!0);this.bandIdsGreenList.set("disabled",!0);this.bandIdsBlueList.set("disabled",
!0);this.bandIdsLabel.style.color="Gray"},_enableBandIds:function(){this.bandIdsRedList.set("disabled",!1);this.bandIdsGreenList.set("disabled",!1);this.bandIdsBlueList.set("disabled",!1);""===this.bandIdsRedList.value&&this.bandIdsRedList.attr("value","1",!1);""===this.bandIdsGreenList.value&&this.bandIdsGreenList.attr("value","2",!1);""===this.bandIdsBlueList.value&&this.bandIdsBlueList.attr("value","3",!1);this._isStretchRenderer(this.layer.renderer)||this._getStretchFunction(this.layer.renderingRule)||
this._updateStretchStatsGrid();this.bandIdsLabel.style.color="Black"},_showBandIds:function(){this.bandIdsLabelBlock.style.display="";this.bandIdsBlock.style.display="";this.bandIdsMsgBlock.style.display=""},_hideBandIds:function(){this.bandIdsLabelBlock.style.display="none";this.bandIdsBlock.style.display="none";this.bandIdsMsgBlock.style.display="none"},_hideStretch:function(){this.imageEnhancementLabel.style.display="none";this.stretchDescLabel.style.display="none";this.stretchMethodLabel.style.display=
"none";this.stretchMethodList.domNode.style.display="none";this._hideStretchOptions(!0)},_hideStretchOptions:function(a){var b="";a&&(b="none");this.gammaBlock.style.display=b;this.draBlock.style.display=b;this.stretchMethodNoneDescBlock.style.display="none";this.stretchMethodMinMaxDescBlock.style.display="none";this.numStdDevBlock.style.display="none";this.minMaxPercentDescBlock.style.display="none";this.minPercentBlock.style.display="none";this.maxPercentBlock.style.display="none";this.stretchStatsBlock.style.display=
"none"},_getDefaultRedBandIndex:function(){var a;this._redBandIdStore&&(a=this._redBandIdStore.get("Red"));a||(a=1);return a},_getClassifyGridData:function(a){var b=this.classifyMethodSelect.value,c=Math.min(this.classifyNClassesInput.value,16),d=this.colorRampSelect.colorRamp,e=this.classifyIntervalInput.value,g=this.classifyFieldSelect.value;this._classifySymbolData||(a=!1);if(this.layer&&b&&c&&d&&(b=a?this._classifySymbolData:this._getClassBreaks(b,c,g,e))){var f=this._getClassifyColormap(d,b.length,
b.length),k=a?this._classifySymbolData:[],l;h.forEach(b,function(b,c){l={r:f[c][1],g:f[c][2],b:f[c][3],a:1};a?k[c].esriRenderingRuleClassifySymbol=l:k.push({esriRenderingRuleClassifySymbol:l,minValue:b.minValue,maxValue:b.maxValue,esriRenderingRuleClassifyLabel:"\u2264 "+Math.floor(1E3*b.maxValue)/1E3})});return k}},_getClassBreaks:function(a,b,c,d){var e=this._cachedHistogramsList&&this._cachedHistogramsList[this.layer.id]?this._cachedHistogramsList[this.layer.id][this.rasterFunctionList.value]:
null,g=this._cachedRATList&&this._cachedRATList[this.layer.id]?this._cachedRATList[this.layer.id][this.rasterFunctionList.value]:null,f,k,l;if(this.layer&&(g||e)){if(g){var e=g.features,u=[];f=k=e[0].attributes[c];h.forEach(e,function(a){a.attributes.Count&&u.push(a.attributes.Count);l=a.attributes[c];l<f&&(f=l);l>k&&(k=l)});d&&16<(k-f)/d&&(d=(k-f)/16);return J.calculateClassBreaks(e,null,c,null,null,a,b,null,u,d)}if(e&&e.length&&e[0].dataPoints&&e[0].counts)return f=e[0].dataPoints[0],k=e[0].dataPoints[e[0].dataPoints.length-
1],d&&16<(k-f)/d&&(d=(k-f)/16),J.calculateClassBreaks(null,e[0].dataPoints,null,null,null,a,b,null,e[0].counts,d)}},_getClassifyColormap:function(a,b,c){if(a&&b){var d=a.colorRamps?a.colorRamps.length:1,e=[],g=[],f=[],k,l,u,m,q,n=0,p=0;c=c||256;for(n=0;n<d;n++)e[n]={},e[n].start=p,e[n].end=p+1/d,p=e[n].end;for(n=0;n<b;n++)m=(n+.5)/b,h.forEach(e,function(b,c){m>=b.start&&m<b.end&&(q=(m-b.start)/(b.end-b.start),1<e.length?(k=this._getColorRGB(a.colorRamps[c].fromColor),l=this._getColorRGB(a.colorRamps[c].toColor)):
(k=this._getColorRGB(a.fromColor),l=this._getColorRGB(a.toColor)),u=this._interpolateLab(k,l,q),f.push(u))},this);for(n=0;n<c;n++)d=f[n%b],g.push([n,d.r,d.g,d.b]);return g}},_getUniqueValuesGridData:function(a){var b=this._getCurrentServiceInfo(),c=b&&b.hasRasterAttributeTable?b.hasRasterAttributeTable:this.layer.hasRasterAttributeTable,b=this.layer.rasterAttributeTable,d=this.rasterFunctionList.value;d!==this._defaultBandCombinationFncName&&this._cachedRATList[this.layer.id]&&this._cachedRATList[this.layer.id][d]&&
(b=this._cachedRATList[this.layer.id][d]);if(c&&b){var e=this.colorRampSelect.colorRamp,c=this.uniqueValuesFieldSelect.value,g,d=e&&e.colorRamps?e.colorRamps.length:1,f=[],k=[],l,m,q,p,n,t=0,v=0;a?k=g=this._uniqueValuesSymbolData:(g=b.features,g=this._sortFeatures(g,c));if(e&&g&&c){for(v=0;v<d;v++)f[v]={},f[v].start=t,f[v].end=t+1/d,t=f[v].end;h.forEach(g,function(b,c){p=(c+.5)/g.length;h.forEach(f,function(d,h){p>=d.start&&p<d.end&&(n=(p-d.start)/(d.end-d.start),1<f.length?(l=this._getColorRGB(e.colorRamps[h].fromColor),
m=this._getColorRGB(e.colorRamps[h].toColor)):(l=this._getColorRGB(e.fromColor),m=this._getColorRGB(e.toColor)),q=this._interpolateLab(l,m,n),a?g[c].esriRenderingRuleUniqueValuesSymbol=this._correctRgbLimits(q):k.push({esriRenderingRuleUniqueValuesSymbol:this._correctRgbLimits(q),esriRenderingRuleUniqueValuesValue:b.value,esriRenderingRuleUniqueValuesLabel:C.isDefined(b.value)?b.value.toString():"",pixelValues:b.pixelValues}))},this)},this);return k}}},_areFieldValuesUnique:function(a,b){var c=[];
return h.some(b,function(b){if(-1<c.indexOf(b.attributes[a]))return!0;c.push(b.attributes[a])})?!1:!0},_sortFeatures:function(a,b){if(a&&b){a=f.clone(a);var c=[],d=[];this._areFieldValuesUnique(b,a)||a.sort(function(a,c){return"string"===typeof a.attributes[b]?a.attributes[b]<c.attributes[b]?-1:1:a.attributes[b]-c.attributes[b]});h.forEach(a,function(a,f){0<f&&-1<d.indexOf(a.attributes[b])?c[d.indexOf(a.attributes[b])].pixelValues.push(a.attributes.Value):(d.push(a.attributes[b]),c.push({value:a.attributes[b],
pixelValues:[a.attributes.Value]}))});return c}},_getColorRGB:function(a){return{r:a[0],g:a[1],b:a[2]}},_interpolateLab:function(a,b,c){a=D.toLAB(a);b=D.toLAB(b);return D.toRGB({l:a.l*(1-c)+c*b.l,a:a.a*(1-c)+c*b.a,b:a.b*(1-c)+c*b.b})},_correctRgbLimits:function(a){var b=[a.r,a.g,a.b];h.forEach(b,function(a,d){0>b[d]?b[d]=0:255<b[d]&&(b[d]=255);b[d]=Math.floor(b[d])});return{r:b[0],g:b[1],b:b[2],a:1}},_isStretchGridDataValid:function(){var a=this._stretchStatsData,b;return a&&a.length?h.some(a,function(a){for(var c in a)if(b=
a[c],a.hasOwnProperty(c)&&"id"!==c&&void 0!==b&&null!==b&&!isNaN(b))return!0}):!1},_sanitizeStretchStatsData:function(a){if(a)return h.forEach(a,function(a){for(var b in a)void 0===a[b]&&(a[b]=null)}),a},_convertColorRamps:function(a,b){if(a){var c=null;if(a.type&&"multipart"==a.type.toLowerCase()){var c=new V,d=[];h.forEach(a.colorRamps,function(a){var b=new K;b.algorithm="hsv";b.fromColor=new x(a.fromColor);b.toColor=new x(a.toColor);d.push(b)});c.colorRamps=d}else c=new K,c.algorithm="hsv",c.fromColor=
new x(a.fromColor),c.toColor=new x(a.toColor);c.name=b;return c}},gammaTooltipClose:function(){this._gammaSliderTooltip&&this._gammaSliderTooltip.close()}});P("extend-esri")&&f.setObject("dijit.RenderingRule",B,R);return B});