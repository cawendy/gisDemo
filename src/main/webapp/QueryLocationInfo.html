<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>QueryLocationInfo</title>
    <link rel="stylesheet" href="./thirdLib/arcgis_js_api/library/3.21/3.21/esri/css/esri.css">
    <link rel="stylesheet" href="./thirdLib//arcgis_js_api/library/3.21/3.21/dijit/themes/claro/claro.css">
    <link rel="stylesheet" href="./components/QueryLocationInfo/css/Style.css">
    <style>
        html, body, #map {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
        }
        body {
            background-color: #FFF;
            overflow: hidden;
            font-family: "Trebuchet MS";
        }
        #toolbar {
            position: relative;
            width: 100%;
            height: 50px;
            background-color: white;
            box-shadow: inset 0px -2px 0px #ddd;
        }
    </style>
    <script src="./js/config/dojoconfig.js"></script>
    <script src="./thirdLib/arcgis_js_api/library/3.21/3.21/init.js"></script>
    <script>
		var map;
		require(["esri/map",
                "esri/layers/ArcGISTiledMapServiceLayer",
                "components/QueryLocationInfo/QueryLocationInfo",
                "esri/tasks/QueryTask",
                "esri/tasks/query",
                "dojo/on",
                "dojo/topic",
                "dojo/_base/lang",
                "dojo/domReady!"],
				function(Map, ArcGISTiledMapServiceLayer,QueryLocationInfo,QueryTask,query,on,topic,lang) {

					map = new Map("map", {
                        basemap: "topo",
						center: [100, 36],
						zoom:13
					});

					//var tiled = new ArcGISTiledMapServiceLayer("http://99.12.100.11:6080/arcgis/rest/services/basemap/MapServer");
					//map.addLayer(tiled);

					on(map, "load",this.onMapLoaded);
					var locator = new QueryLocationInfo({
						container:dojo.byId("toolbar")
					});
					locator.startup();

					topic.subscribe("locationInfo", lang.hitch(this, function (value) {
                        console.log(value);
					}));
                    function onMaploaded() {

						var queryTask = new QueryTask(ioc.map.branchQuery);
						var query = new Query();
						query.outFields=["*"];
						query.geometry = map.extent;
						query.spatialRelationship = Query.SPATIAL_REL_INTERSECTS;
						query.returnGeometry = true;
						queryTask.execute(query, lang.hitch(this, function (result) {

							for(var i=0;i<result.features.length;i++){
							}

							var locator = new QueryLocationInfo({
								container:dojo.byId("toolbar")
							});
							locator.startup();
						}));
					}
				}
		);
    </script>
</head>
<body class="claro">
    <div id="toolbar" >
    </div>
    <div id="map"></div>

</body>
</html>